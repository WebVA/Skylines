{% from "flights/flights-table.jinja" import render_flights_table with context %}
{% from "macros/links.jinja" import user_link, club_link %}

{% from 'macros/pager.jinja' import pager, pager_script, pager_shortcut_script, pager_status with context %}
{% from 'macros/sorter.jinja' import sorter_script with context %}


{% extends "base-page.jinja" %}
{% set active_page = "flights" %}
{% set use_ember = true %}


{% block title -%}
{% if pilot -%}
  {% trans pilot=user_link(pilot) -%}
    Flights <small>of {{ pilot }}</small>
  {%- endtrans %}
{%- elif club %}
  {% trans club=club_link(club) -%}
    Flights <small>of {{ club }}</small>
  {%- endtrans %}
{%- elif airport %}
  {% trans airport=airport.name|e -%}
    Flights <small>from {{ airport }}</small>
  {%- endtrans %}
{%- elif date %}
  {% trans date=h.format_date(date) -%}
    Flights <small>on {{ date }}</small>
  {%- endtrans %}
{%- else %}
  {% trans %}Flights{% endtrans -%}
{%- endif %}
{%- endblock %}


{% block styles -%}
{{ super() }}
{%- endblock %}

{% block content -%}
{% include "flights/nav.jinja" with context %}

{%- set omitted_columns = [] %}
{%- if date %}{% do omitted_columns.append('date') %}{% endif %}
{%- if club or pilot %}{% do omitted_columns.append('club') %}{% endif %}
{%- if airport %}{% do omitted_columns.append('takeoff_airport') %}{% endif %}
{%- if tab == 'all' %}{% do omitted_columns.append('times') %}{% endif %}
{%- if tab == 'unassigned' %}{% do omitted_columns.append('pilot') %}{% endif %}

{% with page=g.paginators['flights'] -%}
<div id="page-position"
     data-page-prev="{{ h.max(page.first_page, page.page - 1) }}"
     data-page-current="{{ page.page }}"
     data-page-next="{{ h.min(page.last_page, page.page + 1) }}"></div>
{% endwith %}

<div class="row">
  <div class="col-sm-6">
    {{ pager_status('flights') }}
  </div>
  <div class="col-sm-6">
    <div class="pull-right">
      {{ pager('flights', dict(**g.sorters['flights'].args())) }}
    </div>
  </div>
</div>

{{ render_flights_table(flights, omitted_columns) }}

<div class="row">
  <div class="col-sm-6">
    {{ pager_status('flights') }}
  </div>
  <div class="col-sm-6">
    <div class="pull-right">
      {{ pager('flights', dict(**g.sorters['flights'].args())) }}
    </div>
  </div>
</div>

{%- endblock %}


{% block scripts -%}
{{ super() }}

<script>
$(function() {
    $('#datepicker').datepicker({
      weekStart: 1
    })
    .on('changeDate', function(e) {
      window.location.href = "/flights/date/" + e.date.getFullYear() + "-" +
        pad(e.date.getMonth()+1, 2) + "-" + pad(e.date.getDate(), 2);
    });

    showPinnedFlightsLink();
  });
</script>

<script>
$(function() {
  var flightTable = $('#flight-table');
  flightTable.find("[rel=tooltip]").tooltip();
});
</script>
{%- endblock %}


{% block title_right -%}
<a href="{{ url_for('upload.index') }}" class="btn btn-success">
  <i class="icon-upload-alt"></i> {{ _('Upload flight') }}
</a>
{%- endblock %}
