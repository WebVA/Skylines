{% from "macros/flags.jinja" import insert_flag with context %}
{% from "macros/datetime.jinja" import insert_timeago, timeago_script with context %}

{% extends "base-page.jinja" %}
{% set active_page = "tracking" %}


{% block title %}{% trans %}Live Tracking{% endtrans %}{% endblock %}


{%- block head %}
{{ super() }}
{{ timeago_script() }}
{%- endblock %}


{% block content -%}
<table id="flight-table" class="table table-striped">
  <thead>
    <tr>
      <th class="date">{% trans %}Last fix{% endtrans %}</th>
      <th>{% trans %}Pilot / Traffic ID{% endtrans %}</th>
      <th>{% trans %}Nearest Airport{% endtrans %}</th>
    </tr>
  </thead>
  <tbody>
    {% for track, airport, distance in tracks -%}
    <tr>
      <td class="date">{{ insert_timeago(track.time) }}</td>
      <td>
        {% if track.pilot_id -%}
        <a href="/users/{{ track.pilot_id }}">{{ track.pilot|e }}</a>
        {%- elif track.tracking_type == 0 -%}
        Flarm {{ '%X'|format(track.tracking_id) }}
        {%- elif track.tracking_type == 1 -%}
        ICAO {{ '%X'|format(track.tracking_id) }}
        {%- endif %}
      </td>
      <td>
        {% if airport -%}
        {{ insert_flag(airport.country_code) }} {{ airport|e }} ({{ h.format_distance(distance) }})
        {%- endif %}
      </td>
      <td nowrap="nowrap" class="show">
        {% if track.pilot_id -%}
        <a href="/tracking/{{ track.pilot_id }}/" class="btn btn-mini">Show</a>
        {%- elif track.tracking_type -%}
        <a href="/tracking/external/{{ track.tracking_type }}/{{ track.tracking_id }}/" class="btn btn-mini">Show</a>
        {%- endif %}
      </td>
    </tr>
    {%- endfor %}
  </tbody>
</table>

<a href="/tracking/info" class="btn"><i class="icon-question-sign"></i> {% trans %}How to use Live Tracking?{% endtrans %}</a>
{%- endblock %}
